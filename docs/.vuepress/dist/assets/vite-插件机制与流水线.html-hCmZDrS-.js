import{_ as o,r as p,o as t,c,f as l,b as n,d as a,e,a as i}from"./app-2r9GXMNB.js";const u={},r=i(`<h1 id="é™ˆåŒå­¦iå‰ç«¯-ä¸€èµ·å­¦vite-æ’ä»¶æœºåˆ¶ä¸æµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#é™ˆåŒå­¦iå‰ç«¯-ä¸€èµ·å­¦vite-æ’ä»¶æœºåˆ¶ä¸æµæ°´çº¿" aria-hidden="true">#</a> [é™ˆåŒå­¦iå‰ç«¯] ä¸€èµ·å­¦Viteï½œæ’ä»¶æœºåˆ¶ä¸æµæ°´çº¿</h1><h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h2><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é™ˆåŒå­¦ï¼Œä¸€æšé‡ç”Ÿå‰ç«¯å¼€å‘è€…ï¼Œæ„Ÿè°¢å„ä½çš„<strong>ç‚¹èµã€æ”¶è—ã€è¯„è®º</strong></p><p>è¿‘å¹´æ¥ï¼Œå‰ç«¯é¢†åŸŸæŠ€æœ¯æ›´æ–°è¿­ä»£èŠ‚å¥è¾ƒå¿«ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆä»¬ä¸ºäº†æ›´å¥½çš„è¿›è¡Œé¡¹ç›®å¼€å‘ã€æµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²ï¼Œå¼€å‘å‡ºäº†å„ç§å„æ ·çš„æ„å»ºå·¥å…·</p><p>åƒå¸¸è§çš„Webpackã€Rollupã€Esbuildã€Viteï¼Œæ¯ä¸€ç±»å·¥å…·éƒ½æœ‰å®ƒçš„ç‰¹ç‚¹ï¼Œå‡è‡´åŠ›äºæé«˜å‰ç«¯é¢†åŸŸçš„å·¥ç¨‹åŒ–æ°´å¹³</p><p>è€Œå·¥å…·å‡ºç°çš„ç›®æ ‡æ˜¯<strong>è§£å†³å‰ç«¯å·¥ç¨‹å½“ä¸­çš„ä¸€äº›å½±å“é€šæ€§é—®é¢˜</strong></p><p>å¸¸è§çš„ç—›ç‚¹ï¼ˆéœ€æ±‚ç‚¹ï¼‰æœ‰ï¼šæ¨¡å—åŒ–éœ€æ±‚ï¼ˆESMï¼‰ã€å…¼å®¹é«˜çº§è¯­æ³•ã€ä»£ç è´¨é‡æµ‹è¯•ã€é™æ€èµ„æºå¤„ç†ã€ä»£ç å‹ç¼©ã€å¼€å‘æ•ˆç‡ç­‰</p><p>æœ¬èŠ‚æˆ‘ä»¬ç»§ç»­è¿›è¡Œ<code>Vite</code>çŸ¥è¯†çš„å­¦ä¹ ï¼Œå…·ä½“å®‰æ’å¦‚ä¸‹ï¼š</p><ul><li>ä¸€èµ·å­¦Viteï½œåˆè¯†ä¸‹ä¸€ä»£çš„å‰ç«¯å·¥å…·é“¾</li><li>ä¸€èµ·å­¦Viteï½œåŸæ¥è¿™ç©æ„å«ä¾èµ–é¢„æ„å»º</li><li>ä¸€èµ·å­¦Viteï½œå®ç°ç¬¬ä¸€ä¸ªViteæ’ä»¶</li><li>ä¸€èµ·å­¦Viteï½œæ’ä»¶æœºåˆ¶ä¸æµæ°´çº¿ï¼ˆæœ¬èŠ‚ï¼‰</li><li>ä¸€èµ·å­¦Viteï½œHMRï¼Œä½ å¥½ğŸ‘‹</li><li>ä¸€èµ·å­¦Viteï½œæ¨¡å—è”é‚¦â€”â€”ä»£ç å…±äº«çš„ç»ˆæè§£å†³æ–¹æ¡ˆ</li><li>ä¸€èµ·å­¦Viteï½œç®€å•æ‰‹å†™å¼€å‘æœåŠ¡å™¨</li><li>ä¸€èµ·å­¦Viteï½œç®€å•æ‰‹å†™æ‰“åŒ…å™¨</li></ul><p>æœ¬æ–‡é˜…è¯»æˆæœ¬ä¸æ”¶ç›Šå¦‚ä¸‹ï¼š</p><p>é˜…è¯»è€—æ—¶ï¼š<code>7mins</code></p><p>å…¨æ–‡å­—æ•°ï¼š<code>7k+</code></p><h2 id="é¢„æœŸæ•ˆç›Š" tabindex="-1"><a class="header-anchor" href="#é¢„æœŸæ•ˆç›Š" aria-hidden="true">#</a> é¢„æœŸæ•ˆç›Š</h2><ul><li>äº†è§£<code>Vite</code>æ’ä»¶æœºåˆ¶</li><li>äº†è§£<code>Vite</code>æ’ä»¶é’©å­åˆ†ç±»</li><li><code>Vite</code>æ’ä»¶é’©å­æ‰§è¡Œé¡ºåº</li><li><code>Vite</code>æ’ä»¶æµæ°´çº¿é¡ºåº</li></ul><h2 id="viteæ’ä»¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#viteæ’ä»¶æœºåˆ¶" aria-hidden="true">#</a> <code>Vite</code>æ’ä»¶æœºåˆ¶</h2><p><code>Vite</code> çš„æ’ä»¶æœºåˆ¶æ˜¯ä¸ <code>Rollup</code> å…¼å®¹çš„ï¼Œä½†å®ƒåœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸‹çš„å®ç°ç¨æœ‰å·®åˆ«</p><ul><li>ç”Ÿäº§ç¯å¢ƒ: <code>Vite</code> ç›´æ¥è°ƒç”¨ <code>Rollup</code> è¿›è¡Œæ‰“åŒ…</li><li>å¼€å‘ç¯å¢ƒ: <code>Vite</code> æ¨¡æ‹Ÿäº† <code>Rollup</code> çš„æ’ä»¶æœºåˆ¶ï¼Œé€šè¿‡ <code>PluginContainer</code> æ’ä»¶å®¹å™¨å¯¹è±¡è°ƒåº¦æ‰§è¡Œå„ä¸ªæ’ä»¶</li></ul><p><img src="https://charlex-1307761018.cos.ap-guangzhou.myqcloud.com/image/20230103104033.png" alt="20230103104033"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>Vite</code> æ’ä»¶æœºåˆ¶æ˜¯é€šè¿‡ mock <code>Rollup</code>æ’ä»¶æœºåˆ¶è¿›è¡Œå®ç°ï¼Œæ ¸å¿ƒå®ç°ä¸»è¦åŸºäºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>PluginContaineræ’ä»¶å®¹å™¨</code>ï¼šå®ç°å¼€å‘ç¯å¢ƒä¸‹<code>Rollupæ’ä»¶é’©å­è°ƒåº¦</code></li><li><code>PluginContextä¸Šä¸‹æ–‡å¯¹è±¡</code>ï¼šå®ç°æ’ä»¶é’©å­å†…éƒ¨æ‰§è¡Œæ—¶<strong>å…±äº«ä¸Šä¸‹æ–‡ä¿¡æ¯</strong></li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PluginContainer</span> <span class="token punctuation">{</span>
  options<span class="token operator">:</span> InputOptions
  <span class="token function">getModuleInfo</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> ModuleInfo <span class="token operator">|</span> <span class="token keyword">null</span>
  <span class="token function">buildStart</span><span class="token punctuation">(</span>options<span class="token operator">:</span> InputOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
  <span class="token function">resolveId</span><span class="token punctuation">(</span>
    id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    importer<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      assertions<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span>
      custom<span class="token operator">?</span><span class="token operator">:</span> CustomPluginOptions
      skip<span class="token operator">?</span><span class="token operator">:</span> Set<span class="token operator">&lt;</span>Plugin<span class="token operator">&gt;</span>
      ssr<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
      <span class="token doc-comment comment">/**
       * <span class="token keyword">@internal</span>
       */</span>
      scan<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
      isEntry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>PartialResolvedId <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>
    code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      inMap<span class="token operator">?</span><span class="token operator">:</span> SourceDescription<span class="token punctuation">[</span><span class="token string">&#39;map&#39;</span><span class="token punctuation">]</span>
      ssr<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>SourceDescription <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span>
  <span class="token function">load</span><span class="token punctuation">(</span>
    id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      ssr<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>LoadResult <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">PluginContext</span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>
  RollupPluginContext<span class="token punctuation">,</span>
  <span class="token comment">// not supported</span>
  <span class="token operator">|</span> <span class="token string">&#39;load&#39;</span>
  <span class="token comment">// not documented</span>
  <span class="token operator">|</span> <span class="token string">&#39;cache&#39;</span>
  <span class="token comment">// deprecated</span>
  <span class="token operator">|</span> <span class="token string">&#39;moduleIds&#39;</span>
<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ’ä»¶å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#æ’ä»¶å®¹å™¨" aria-hidden="true">#</a> æ’ä»¶å®¹å™¨</h3><p><code>æ’ä»¶å®¹å™¨</code>å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«å¤šç§æ’ä»¶é’©å­è°ƒåº¦æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯ç§é’©å­çš„è°ƒåº¦æ‰§è¡Œæ–¹æ³•æœ‰ç€ç‹¬ç‰¹çš„è°ƒåº¦ç‰¹ç‚¹ä»¥åŠé€»è¾‘</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>pluginA<span class="token punctuation">,</span> pluginB<span class="token punctuation">,</span> pluginC<span class="token punctuation">,</span> pluginD<span class="token punctuation">,</span> pluginE<span class="token punctuation">]</span> <span class="token comment">// pluginsä¸ºViteæ ¹æ®ç”¨æˆ·é…ç½®å·²ç»æ•´ç†å¥½çš„æ’ä»¶æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä¸ºä¸€ä¸ªæ’ä»¶å¯¹è±¡</span>
<span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¼‚æ­¥ä¸²è¡Œé’©å­</span>
  options<span class="token operator">:</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> options <span class="token operator">=</span> rollupOptions
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plugin<span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token keyword">continue</span>
      options <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token keyword">await</span> plugin<span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>minimalContext<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> options
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// å¼‚æ­¥å¹¶è¡Œé’©å­ï¼Œæ­¤å¤„çœç•¥äº†sequentialæƒ…å†µå¤„ç†</span>
  <span class="token keyword">async</span> <span class="token function">buildStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
      plugins<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>plugin<span class="token punctuation">.</span>buildStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> plugin<span class="token punctuation">.</span><span class="token function">buildStart</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
            container<span class="token punctuation">.</span>options <span class="token keyword">as</span> NormalizedInputOptions
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// å¼‚æ­¥ä¼˜å…ˆé’©å­</span>
  <span class="token keyword">async</span> <span class="token function">resolveId</span><span class="token punctuation">(</span>rawId<span class="token punctuation">,</span> importer<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåæ–‡ä»‹ç»</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">const</span> partial<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>PartialResolvedId<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> plugin<span class="token punctuation">.</span><span class="token function">resolveId</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
        ctx <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
        rawId<span class="token punctuation">,</span>
        importer<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¼‚æ­¥ä¼˜å…ˆé’©å­</span>
  <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> plugin<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> result
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// å¼‚æ­¥ä¸²è¡Œé’©å­</span>
  <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> id<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> inMap <span class="token operator">=</span> options<span class="token operator">?.</span>inMap
    <span class="token keyword">const</span> ssr <span class="token operator">=</span> options<span class="token operator">?.</span>ssr
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransformContext</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> code<span class="token punctuation">,</span> inMap <span class="token keyword">as</span> SourceMap<span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span>ssr <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>ssr
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> result<span class="token operator">:</span> TransformResult <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token keyword">await</span> plugin<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token punctuation">{</span> ssr <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token comment">// çœç•¥ SourceMap åˆå¹¶çš„é€»è¾‘</span>
      code <span class="token operator">=</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      code<span class="token punctuation">,</span>
      map<span class="token operator">:</span> ctx<span class="token punctuation">.</span><span class="token function">_getCombinedSourcemap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>closed<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">hookParallel</span><span class="token punctuation">(</span>
        <span class="token string">&#39;buildEnd&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">hookParallel</span><span class="token punctuation">(</span>
        <span class="token string">&#39;closeBundle&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    closed <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº†æ’ä»¶å®¹å™¨ï¼Œ<code>Vite</code>ä¾¿å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨å¯¹åº”çš„æ’ä»¶å®¹å™¨æ–¹æ³•è¿›è¡Œå„ä¸ªæ’ä»¶é’©å­é€»è¾‘çš„è°ƒåº¦æ‰§è¡Œ</p><p>å¼€å‘è€…åªéœ€è¦æŒ‰ç…§çº¦å®šå¼€å‘å¥½ä¸€ä¸ªæ’ä»¶ï¼Œåœ¨<code>Vite</code>é…ç½®çš„<code>plugins</code>å±æ€§æ·»åŠ æ’ä»¶å¯¹è±¡ï¼Œåç»­çš„æ­¤æ’ä»¶å†…çš„é€»è¾‘æ‰§è¡Œæ—¶æœºä¾¿ç”±<code>Viteæ’ä»¶å®¹å™¨</code>è¿›è¡Œæ§åˆ¶</p><blockquote><p>è¿™é‡Œä¸ºäº†åŠ æ·±ç†è§£ï¼Œé€šè¿‡<code>load</code>é’©å­è¿›è¡Œè¯´æ˜</p></blockquote><p><img src="https://charlex-1307761018.cos.ap-guangzhou.myqcloud.com/image/20230103145423.png" alt="20230103145423"></p><p><code>load</code>å±äºå¼‚æ­¥ä¼˜å…ˆé’©å­å‡½æ•°ï¼Œåœ¨æ¯ä¸ª<code>ä¼ å…¥æ¨¡å—è¯·æ±‚</code>(import)æ—¶è¢«è°ƒç”¨</p><p>åœ¨<code>Vite</code>ä¾æ¬¡è°ƒåº¦æ¯ä¸ªæ’ä»¶çš„<code>load</code>å®ç°é€»è¾‘è¿‡ç¨‹ä¸­ï¼Œåªè¦æœ‰ä¸€ä¸ªæ’ä»¶çš„<code>load</code>æ–¹æ³•å®ç°èƒ½å¤Ÿæ­£ç¡®å¤„ç†å¹¶è¿”å›ç»“æœï¼Œåˆ™å¿½ç•¥åç»­æ’ä»¶å®ç°çš„<code>load</code>æ–¹æ³•é€»è¾‘</p><h3 id="æ’ä»¶ä¸Šä¸‹æ–‡" tabindex="-1"><a class="header-anchor" href="#æ’ä»¶ä¸Šä¸‹æ–‡" aria-hidden="true">#</a> æ’ä»¶ä¸Šä¸‹æ–‡</h3><p>Viteä¸­çš„<code>æ’ä»¶ä¸Šä¸‹æ–‡</code>æŒ‡çš„æ˜¯åœ¨æ’ä»¶å®¹å™¨çš„æŸä¸€é’©å­ï¼ˆå¦‚ï¼šloadï¼‰ç®¡é“å¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ–°åˆ›å»ºç”¨äºè®°å½•æ¯ä¸€ä¸ªå¼‚æ­¥é’©å­ç®¡é“å½“å‰çŠ¶æ€çš„å¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥å¹¶å‘å®‰å…¨åœ°è·Ÿè¸ªè¯¥ç®¡é“ä¸­çš„æ´»åŠ¨æ’ä»¶ï¼Œå¹¶æä¾›ä¸€äº›å·¥å…·æ–¹æ³•è¿›ä¸€æ­¥æé«˜æ’ä»¶é’©å­å‡½æ•°çš„çµæ´»æ€§</p><p>æ•…åœ¨å„ç§æ’ä»¶ä¸­çš„é’©å­è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>Vite</code>æ’ä»¶å®¹å™¨çš„è°ƒåº¦é€»è¾‘ä¼šå¼ºåˆ¶ä¸ºé’©å­å‡½æ•°çš„ <code>this</code> ç»‘å®šä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡</p><p>ä¸Šä¸‹æ–‡å¯¹è±¡ç±»å‹ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://charlex-1307761018.cos.ap-guangzhou.myqcloud.com/image/20230103152218.png" alt="20230103152218"></p><h2 id="viteæ’ä»¶é’©å­" tabindex="-1"><a class="header-anchor" href="#viteæ’ä»¶é’©å­" aria-hidden="true">#</a> <code>Vite</code>æ’ä»¶é’©å­</h2><h3 id="ç‹¬æœ‰é’©å­ä¸å±æ€§" tabindex="-1"><a class="header-anchor" href="#ç‹¬æœ‰é’©å­ä¸å±æ€§" aria-hidden="true">#</a> ç‹¬æœ‰é’©å­ä¸å±æ€§</h3><ul><li>enforce: <code>pre</code>Â æˆ–Â <code>post</code> ï¼Œ <code>pre</code> å…ˆæ‰§è¡Œ</li><li>apply: <code>build</code> æˆ– <code>serve</code> æˆ– <code>å‡½æ•°</code>ï¼Œæ ‡è®°å½“å‰æ’ä»¶ä»…åœ¨ <code>build</code> æˆ– <code>serve</code> æ‰§è¡Œç¯å¢ƒä¸‹ä½¿ç”¨</li><li>config(config, env): åœ¨ <code>Vite</code> é…ç½®è¢«è§£æä¹‹å‰ä¿®æ”¹ <code>Vite</code> çš„ç›¸å…³é…ç½®ã€‚é’©å­å‡½æ•°æ¥æ”¶ <code>config</code>(åŸå§‹ç”¨æˆ·é…ç½®) å’Œ <code>env</code>(æè¿°é…ç½®ç¯å¢ƒçš„å˜é‡)å…¥å‚</li><li>configResolved(resolvedConfig): åœ¨è§£æ <code>Vite</code> é…ç½®åè°ƒç”¨ã€‚ä½¿ç”¨è¿™ä¸ªé’©å­è¯»å–å’Œå­˜å‚¨<code>æœ€ç»ˆè§£æçš„é…ç½®</code></li><li>configureServer(server): ä¸»è¦ç”¨æ¥ <code>é…ç½®å¼€å‘æœåŠ¡å™¨</code><ul><li>æ³¨å…¥å‰ç½®ä¸­é—´ä»¶ï¼šé’©å­å‡½æ•°åœ¨å†…éƒ¨ä¸­é—´ä»¶è¢«å®‰è£…å‰è°ƒç”¨ï¼Œå¯ä¸º <code>dev-server</code> æ·»åŠ è‡ªå®šä¹‰çš„å‰ç½®ä¸­é—´ä»¶</li><li>æ³¨å…¥åç½®ä¸­é—´ä»¶ï¼šé’©å­å‡½æ•°è¿”å›å€¼ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆå®šä¹‰åç½®ä¸­é—´ä»¶ï¼‰æ—¶ï¼Œå¯ä¸º <code>dev-server</code> æ·»åŠ è‡ªå®šä¹‰çš„åç½®ä¸­é—´ä»¶</li><li>å­˜å‚¨æœåŠ¡å™¨è®¿é—®å¼•ç”¨ï¼šå®ç°<code>å…¶ä»–æ’ä»¶é’©å­</code>èƒ½å¤Ÿè®¿é—®å¼€å‘æœåŠ¡å™¨å®ä¾‹</li></ul></li><li>transformIndexHtml(html): è½¬æ¢ <code>index.html</code> çš„ä¸“ç”¨é’©å­ã€‚é’©å­æ¥æ”¶<code>å½“å‰çš„ HTML å­—ç¬¦ä¸²</code>å’Œ<code>è½¬æ¢ä¸Šä¸‹æ–‡</code>ã€‚ä¸Šä¸‹æ–‡åœ¨å¼€å‘æœŸé—´æš´éœ²<code>ViteDevServerå®ä¾‹</code>ï¼Œåœ¨æ„å»ºæœŸé—´æš´éœ² <code>Rollup</code> è¾“å‡ºçš„åŒ…</li><li>handleHotUpdate(ctx): æ‰§è¡Œ<code>è‡ªå®šä¹‰HMRæ›´æ–°</code>ï¼Œå¯ä»¥é€šè¿‡<code>ws</code>å¾€å®¢æˆ·ç«¯å‘é€è‡ªå®šä¹‰çš„äº‹ä»¶</li></ul><h3 id="é€šç”¨é’©å­-æ„å»ºé˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#é€šç”¨é’©å­-æ„å»ºé˜¶æ®µ" aria-hidden="true">#</a> é€šç”¨é’©å­-æ„å»ºé˜¶æ®µ</h3><ul><li>options(options): åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨-è·å–ã€æ“çºµ <code>Rollup</code> é€‰é¡¹ï¼Œï¼ˆä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è®²ï¼Œå®ƒæ‰§è¡Œäºæ„å»ºé˜¶æ®µä¹‹å‰ï¼‰</li><li>buildStart(options): å¼€å§‹æ„å»ºæµç¨‹æ—¶è°ƒç”¨</li><li>resolveId(source, importer, options): åœ¨æ¯ä¸ª<code>ä¼ å…¥æ¨¡å—è¯·æ±‚</code>(import)æ—¶è¢«è°ƒç”¨ï¼Œç”¨äºå¤„ç†ä¼ å…¥æ¨¡å—æ–‡ä»¶çš„è·¯å¾„</li><li>load(id): åœ¨æ¯ä¸ª<code>ä¼ å…¥æ¨¡å—è¯·æ±‚</code>(import)æ—¶è¢«è°ƒç”¨ï¼Œé€šè¿‡è‡ªå®šä¹‰åŠ è½½å™¨ï¼Œå¯å®šåˆ¶è¿”å›çš„è‡ªå®šä¹‰æ ¼å¼å†…å®¹</li><li>transform(code, id): åœ¨æ¯ä¸ª<code>ä¼ å…¥æ¨¡å—è¯·æ±‚</code>(import)æ—¶è¢«è°ƒç”¨ï¼Œç”¨äºè½¬æ¢å•ä¸ªæ¨¡å—æ–‡ä»¶å†…å®¹</li><li>buildEnd(error?: Error): åœ¨æ„å»ºé˜¶æ®µç»“æŸåè¢«è°ƒç”¨</li></ul><h3 id="é€šç”¨é’©å­-è¾“å‡ºé˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#é€šç”¨é’©å­-è¾“å‡ºé˜¶æ®µ" aria-hidden="true">#</a> é€šç”¨é’©å­-è¾“å‡ºé˜¶æ®µ</h3><ul><li>outputOptions(options): æ¥æ”¶è¾“å‡ºå‚æ•°</li><li>renderStart(outputOptions, inputOptions): <code>bundle.generate</code> å’Œ <code>bundle.write</code> è°ƒç”¨æ—¶éƒ½ä¼šè¢«è§¦å‘</li><li>augmentChunkHash(chunkInfo): ä¸º <code>chunk</code> å¢åŠ è‡ªå®šä¹‰æ ¼å¼çš„ <code>hash</code></li><li>renderChunk(code, chunk, options): è½¬è¯‘å•ä¸ªçš„ <code>chunk</code> æ—¶è§¦å‘ã€‚<code>Rollup</code> è¾“å‡ºæ¯ä¸€ä¸ª <code>chunk</code> æ–‡ä»¶çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨</li><li>generateBundle(options, bundle, isWrite): åœ¨è°ƒç”¨ <code>bundle.write</code> ä¹‹å‰ç«‹å³è§¦å‘è¿™ä¸ª <code>hook</code></li><li>writeBundle(options, bundle): åœ¨è°ƒç”¨ <code>bundle.write</code> åï¼Œæ‰€æœ‰çš„ <code>chunk</code> éƒ½å†™å…¥æ–‡ä»¶åï¼Œæœ€åä¼šè°ƒç”¨ä¸€æ¬¡ <code>writeBundle</code></li><li>closeBundle(): æœåŠ¡å™¨å…³é—­æ—¶è°ƒç”¨</li></ul><h3 id="æ’ä»¶é’©å­æ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#æ’ä»¶é’©å­æ‰§è¡Œé¡ºåº" aria-hidden="true">#</a> æ’ä»¶é’©å­æ‰§è¡Œé¡ºåº</h3><p><img src="https://charlex-1307761018.cos.ap-guangzhou.myqcloud.com/image/20230103213158.png" alt="20230103213158"></p><h2 id="æ’ä»¶æµæ°´çº¿ç”Ÿæˆé¡ºåº" tabindex="-1"><a class="header-anchor" href="#æ’ä»¶æµæ°´çº¿ç”Ÿæˆé¡ºåº" aria-hidden="true">#</a> æ’ä»¶æµæ°´çº¿ç”Ÿæˆé¡ºåº</h2><p><code>Vite</code> æ‰€æœ‰çš„æ’ä»¶éƒ½é€šè¿‡<code>resolvePlugins</code>è¢«æ”¶é›†èµ·æ¥</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">resolvePlugins</span><span class="token punctuation">(</span>
  config<span class="token operator">:</span> ResolvedConfig<span class="token punctuation">,</span> <span class="token comment">// ç»è¿‡å¤„ç†åçš„é…ç½®</span>
  prePlugins<span class="token operator">:</span> Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç”¨æˆ·æ’ä»¶æ•°ç»„ï½œenforce: &#39;pre&#39;</span>
  normalPlugins<span class="token operator">:</span> Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç”¨æˆ·æ’ä»¶æ•°ç»„ï½œæœªè®¾ç½®enforce</span>
  postPlugins<span class="token operator">:</span> Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// ç”¨æˆ·æ’ä»¶æ•°ç»„ï½œenforce: &#39;post&#39;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isBuild <span class="token operator">=</span> config<span class="token punctuation">.</span>command <span class="token operator">===</span> <span class="token string">&#39;build&#39;</span>
  <span class="token comment">// æ”¶é›†ç”Ÿäº§ç¯å¢ƒæ„å»ºçš„æ’ä»¶</span>
  <span class="token keyword">const</span> buildPlugins <span class="token operator">=</span> isBuild
    <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;../build&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveBuildPlugins</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token punctuation">{</span> pre<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> post<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// 1. åˆ«åæ’ä»¶</span>
    isBuild <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">preAliasPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">aliasPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> entries<span class="token operator">:</span> config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 2. ç”¨æˆ·æ’ä»¶(enforce: &#39;pre&#39;)</span>
    <span class="token operator">...</span>prePlugins<span class="token punctuation">,</span>
    <span class="token comment">// 3. Vite æ ¸å¿ƒæ„å»ºæ’ä»¶</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// 4. ç”¨æˆ·æ’ä»¶ï¼ˆä¸å¸¦ enforce å±æ€§ï¼‰</span>
    <span class="token operator">...</span>normalPlugins<span class="token punctuation">,</span>
    <span class="token comment">// 5. Vite ç”Ÿäº§ç¯å¢ƒæ’ä»¶</span>
    <span class="token function">definePlugin</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">cssPostPlugin</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>buildPlugins<span class="token punctuation">.</span>pre<span class="token punctuation">,</span>
    <span class="token comment">// 6. ç”¨æˆ·æ’ä»¶(enforce: &#39;post&#39;)</span>
    <span class="token operator">...</span>postPlugins<span class="token punctuation">,</span>
    <span class="token operator">...</span>buildPlugins<span class="token punctuation">.</span>post<span class="token punctuation">,</span>
    <span class="token comment">// 7. ä¸€äº›å¼€å‘é˜¶æ®µç‰¹æœ‰çš„æ’ä»¶</span>
    <span class="token operator">...</span><span class="token punctuation">(</span>isBuild
      <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">clientInjectionsPlugin</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">importAnalysisPlugin</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span> <span class="token keyword">as</span> Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡<code>resolvePlugins</code>å¤„ç†åï¼Œæˆ‘ä»¬èƒ½æ€»ç»“å‡º<code>Vite</code>çš„æ’ä»¶æ‰§è¡Œé¡ºåºï¼š</p><ul><li>åˆ«åå¤„ç†ï¼š<code>Alias</code></li><li>è®¾ç½®<code>enforce: &#39;pre&#39;</code>çš„ç”¨æˆ·æ’ä»¶</li><li><code>Vite</code> æ ¸å¿ƒæ’ä»¶</li><li>æœªè®¾ç½®<code>enforce</code>çš„ç”¨æˆ·æ’ä»¶</li><li><code>Vite</code> ç”Ÿäº§ç¯å¢ƒæ„å»ºæ’ä»¶</li><li>è®¾ç½®<code>enforce: &#39;post&#39;</code>çš„ç”¨æˆ·æ’ä»¶</li><li><code>Vite</code> ç”Ÿäº§ç¯å¢ƒæ„å»ºåç½®æ’ä»¶(<code>minify</code>, <code>manifest</code>, <code>reporting</code>)</li><li>ä¸€äº›å¼€å‘é˜¶æ®µç‰¹æœ‰çš„æ’ä»¶</li></ul><p>å³åœ¨æ¯ä¸€ä¸ªéœ€è¦è°ƒåº¦æ’ä»¶é’©å­èƒ½åŠ›çš„æ—¶æœºï¼Œ<code>Vite</code>ä¾¿ä¼šæŒ‰ç…§ä»¥ä¸Šçš„é¡ºåºè¿›è¡Œæ’ä»¶é’©å­å‡½æ•°çš„è°ƒç”¨</p><h2 id="è®²åˆ°æœ€å" tabindex="-1"><a class="header-anchor" href="#è®²åˆ°æœ€å" aria-hidden="true">#</a> è®²åˆ°æœ€å</h2><p>åœ¨ä¸Šä¸€èŠ‚æ–‡ç« ä¸­æˆ‘ä»¬ç®€å•å®ç°äº†ä¸€ä¸ª<code>Viteæ’ä»¶</code>æŒæ¡äº†åŸºæœ¬çš„æ’ä»¶å¼€å‘æŠ€å·§</p><p>æœ¬èŠ‚æˆ‘ä»¬å¼€å§‹å¯¹<code>Vite</code>çš„æ’ä»¶æœºåˆ¶è¿›è¡Œå­¦ä¹ ï¼Œé¦–å…ˆæˆ‘ä»¬æ˜ç¡®äº†<code>Vite</code>æ’ä»¶æœºåˆ¶æ˜¯ä¸<code>Rollup</code>å…¼å®¹çš„ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹<code>Vite</code>ç›´æ¥è°ƒç”¨<code>Rollup</code>APIè¿›è¡Œæ‰“åŒ…ï¼Œè€Œåœ¨å¼€å‘ç¯å¢ƒä¸‹<code>Vite</code>é€šè¿‡<code>æ’ä»¶å®¹å™¨</code>ä»¥åŠ<code>æ’ä»¶ä¸Šä¸‹æ–‡</code>æ¨¡æ‹Ÿ <code>Rollup</code> çš„æ’ä»¶æœºåˆ¶ï¼Œä»è€Œå¯ä»¥å®ç°åœ¨å¼€å‘ç¯å¢ƒä¸‹å…¼å®¹<code>Rollupæ’ä»¶æœºåˆ¶</code>çš„åŒæ—¶æ‰©å±•<code>Vite</code>ç‹¬æœ‰çš„èƒ½åŠ›</p><p>æ¥ç€æˆ‘ä»¬å°è¯•ç†è§£æ’ä»¶å®¹å™¨å†…è°ƒåº¦é’©å­å‡½æ•°çš„è¡Œä¸ºï¼Œå‘ç°æ¯ä¸€ç§é’©å­å‡½æ•°æœ‰ç€å¯¹åº”çš„è°ƒåº¦æ—¶æœºã€ç‰¹ç‚¹ä»¥åŠé€»è¾‘ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨æ’ä»¶å®¹å™¨å†…<code>å¼‚æ­¥é’©å­ç®¡é“æ–¹æ³•</code>æ—¶ä¼šåˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè®°å½•æ¯ä¸€ä¸ªå¼‚æ­¥é’©å­ç®¡é“å½“å‰çŠ¶æ€çš„å¯¹è±¡</p><p>æœ€ç»ˆæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹<code>resolvePlugins</code>æ–¹æ³•ï¼Œäº†è§£åˆ°æ’ä»¶æµæ°´çº¿ç”Ÿæˆé¡ºåº</p><p>é˜…è¯»å®Œæœ¬ç¯‡æ–‡ç« ï¼Œå¸Œæœ›å¤§å®¶éƒ½èƒ½å¤Ÿå¯¹<code>Viteæ’ä»¶</code>æœ‰ä¸€ä¸ªæ›´æ·±å±‚æ¬¡çš„è®¤çŸ¥</p><p>è°¢è°¢å¤§å®¶ï¼Œæˆ‘ä»¬ä¸‹èŠ‚å†è§ï¼ï¼ï¼</p><blockquote><p>æ„Ÿè°¢å„ä½çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœä½ è§‰å¾—æœ¬èŠ‚å†…å®¹è¿˜ä¸é”™çš„è¯ï¼Œæ¬¢è¿å„ä½çš„<strong>ç‚¹èµã€æ”¶è—ã€è¯„è®º</strong>ï¼Œå¤§å®¶çš„æ”¯æŒæ˜¯æˆ‘åšå†…å®¹çš„æœ€å¤§åŠ¨åŠ›</p></blockquote><blockquote><p>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ›ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©</p></blockquote><h2 id="å‚è€ƒè¡¥å……" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒè¡¥å……" aria-hidden="true">#</a> å‚è€ƒè¡¥å……</h2>`,60),d={href:"https://cn.vitejs.dev/",target:"_blank",rel:"noopener noreferrer"},k={href:"https://rollupjs.org/guide/en/",target:"_blank",rel:"noopener noreferrer"},v={href:"https://esbuild.github.io/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://juejin.cn/book/7050063811973218341",target:"_blank",rel:"noopener noreferrer"},b={href:"https://cn.vuejs.org/",target:"_blank",rel:"noopener noreferrer"};function g(h,f){const s=p("ExternalLinkIcon");return t(),c("div",null,[l(`
 * @LastEditTime: 2023-01-03 15:33:18
 * @FilePath: /frontend_study_charles/publish-article/Viteä¸“æ /vite-æ’ä»¶æµæ°´çº¿.md
 * @Description: desc
 * 
`),r,n("p",null,[n("a",d,[a("Viteå®˜æ–¹æ–‡æ¡£"),e(s)])]),n("p",null,[n("a",k,[a("Rollupå®˜æ–¹æ–‡æ¡£"),e(s)])]),n("p",null,[n("a",v,[a("Esbuildå®˜æ–¹æ–‡æ¡£"),e(s)])]),n("p",null,[n("a",m,[a("æ˜é‡‘å°å†Œ"),e(s)])]),n("p",null,[n("a",b,[a("Vue3æ–‡æ¡£"),e(s)])])])}const w=o(u,[["render",g],["__file","vite-æ’ä»¶æœºåˆ¶ä¸æµæ°´çº¿.html.vue"]]);export{w as default};
